<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Conversor de Comprimento</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Conversor de Unidades de Comprimento</h2>

  <label for="valorEntrada">Valor:</label>
  <input type="number" id="valorEntrada" placeholder="Digite o valor">

  <label for="unidadeDe">De:</label>
  <select id="unidadeDe">
    <option value="metros">Metros (m)</option>
    <option value="kilometros">Quilômetros (km)</option>
    <option value="centimetros">Centímetros (cm)</option>
    <option value="milimetros">Milímetros (mm)</option>
    <option value="milhas">Milhas</option>
    <option value="polegadas">Polegadas (in)</option>
    <option value="pes">Pés (ft)</option>
  </select>

  <label for="unidadePara">Para:</label>
  <select id="unidadePara">
    <option value="metros">Metros (m)</option>
    <option value="kilometros">Quilômetros (km)</option>
    <option value="centimetros">Centímetros (cm)</option>
    <option value="milimetros">Milímetros (mm)</option>
    <option value="milhas">Milhas</option>
    <option value="polegadas">Polegadas (in)</option>
    <option value="pes">Pés (ft)</option>
  </select>

  <button onclick="converter()">Converter</button>
  <button type="button" id="btnLimpar" onclick="limparCampos()">Limpar</button>

  <h3 id="resultado"></h3>

  <div id="historico" aria-live="polite">
    <h4>Histórico (últimas 5 conversões)</h4>
    <ul id="listaHistorico"></ul>
    <button type="button" id="btnLimparHistorico" onclick="limparHistorico()">Limpar histórico</button>
  </div>

  <script>
    /*
      Para facilitar a conversão, primeiro convertemos
      TODAS as entradas para a unidade base (Metros)
      e depois convertemos de Metros para a unidade final.
    */
    const FatoresParaMetro = {
      'metros': 1,
      'kilometros': 1000,
      'centimetros': 0.01,
      'milimetros': 0.001,
      'milhas': 1609.34,
      'polegadas': 0.0254,
      'pes': 0.3048
    };

    function converter() {
      const valorInput = parseFloat(document.getElementById('valorEntrada').value);
      const de = document.getElementById('unidadeDe').value;
      const para = document.getElementById('unidadePara').value;
      const resultadoEl = document.getElementById('resultado');

      if (isNaN(valorInput)) {
        resultadoEl.innerText = "Por favor, insira um valor numérico.";
        return;
      }

      // 1. Converter o valor de entrada para Metros
      const valorEmMetros = valorInput * FatoresParaMetro[de];

      // 2. Converter de Metros para a unidade de saída
      const valorConvertido = valorEmMetros / FatoresParaMetro[para];

      // --- INÍCIO DA MODIFICAÇÃO (Commit 12) ---
      
      // Cria um formatador para o padrão brasileiro (pt-BR)
      // - 'useGrouping: true' (o padrão) garante o separador de milhar (10.000)
      // - 'maximumFractionDigits: 4' limita as casas decimais (0.0100 -> 0,01)
      const formatador = new Intl.NumberFormat('pt-BR', {
        maximumFractionDigits: 4
      });

      // Formata os dois números
      const valorEntradaFormatado = formatador.format(valorInput);
      const valorConvertidoFormatado = formatador.format(valorConvertido);
      // --- FIM DA MODIFICAÇÃO ---

      // Exibe o resultado formatado
      const resultadoTexto = `${valorEntradaFormatado} ${de} = ${valorConvertidoFormatado} ${para}`;
      resultadoEl.innerText = resultadoTexto;

      // adiciona ao histórico (últimas 5)
      adicionarHistorico(resultadoTexto);
    }

    function limparCampos() {
      const valorEl = document.getElementById('valorEntrada');
      const deEl = document.getElementById('unidadeDe');
      const paraEl = document.getElementById('unidadePara');
      const resultadoEl = document.getElementById('resultado');

      // Limpa valores e seleciona a primeira opção (padrão)
      valorEl.value = '';
      if (deEl && deEl.options && deEl.options.length) deEl.selectedIndex = 0;
      if (paraEl && paraEl.options && paraEl.options.length) paraEl.selectedIndex = 0;
      resultadoEl.innerText = '';

      // Volta o foco para o campo de entrada
      valorEl.focus();
    }

    // --- Histórico das conversões (últimas 5) ---
    const HISTORICO_KEY = 'conversor.historico';

    function adicionarHistorico(texto) {
      try {
        const raw = sessionStorage.getItem(HISTORICO_KEY);
        const lista = raw ? JSON.parse(raw) : [];
        lista.unshift({ when: new Date().toISOString(), text: texto });
        // manter apenas as 5 primeiras
        const trimmed = lista.slice(0, 5);
        sessionStorage.setItem(HISTORICO_KEY, JSON.stringify(trimmed));
        renderizarHistorico();
      } catch (e) {
        // se sessionStorage indisponível, ignorar silenciosamente
        console.warn('Não foi possível salvar histórico:', e);
      }
    }

    function renderizarHistorico() {
      const listaEl = document.getElementById('listaHistorico');
      if (!listaEl) return;
      listaEl.innerHTML = '';
      try {
        const raw = sessionStorage.getItem(HISTORICO_KEY);
        const lista = raw ? JSON.parse(raw) : [];
        lista.forEach(item => {
          const li = document.createElement('li');
          const when = new Date(item.when);
          li.innerText = `${when.toLocaleString('pt-BR')}: ${item.text}`;
          listaEl.appendChild(li);
        });
      } catch (e) {
        console.warn('Erro ao renderizar histórico:', e);
      }
    }

    function limparHistorico() {
      try {
        sessionStorage.removeItem(HISTORICO_KEY);
      } catch (e) {
        console.warn('Não foi possível limpar histórico:', e);
      }
      renderizarHistorico();
    }

    // Inicializa histórico ao carregar a página e adiciona atalho Enter
    document.addEventListener('DOMContentLoaded', function() {
      renderizarHistorico();

      // Campos do formulário
      const valorEntrada = document.getElementById('valorEntrada');
      const unidadeDe = document.getElementById('unidadeDe');
      const unidadePara = document.getElementById('unidadePara');

      // Quando o usuário pressiona Enter em qualquer um dos campos, executa a conversão
      const handleEnter = (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          // Só tenta converter se o campo existir
          try { converter(); } catch (err) { console.warn('Erro ao executar conversão via Enter:', err); }
        }
      };

      if (valorEntrada) valorEntrada.addEventListener('keydown', handleEnter);
      if (unidadeDe) unidadeDe.addEventListener('keydown', handleEnter);
      if (unidadePara) unidadePara.addEventListener('keydown', handleEnter);
    });
  </script>
</body>
</html>
